####################################Steps for appending java application logs to a log file####################################################
1) Update the pom.xml withe below dependencies in <dependencies/> section.

		<dependency>
		  <groupId>org.slf4j</groupId>
		  <artifactId>log4j-over-slf4j</artifactId>
		  <version>1.7.32</version><!--$NO-MVN-MAN-VER$-->
		</dependency>
		<dependency>
		  <groupId>ch.qos.logback</groupId>
		  <artifactId>logback-classic</artifactId>
		  <version>1.2.9</version><!--$NO-MVN-MAN-VER$-->
		</dependency>
		<dependency>
		  <groupId>net.logstash.logback</groupId>
		  <artifactId>logstash-logback-encoder</artifactId>
		  <version>6.6</version>
		</dependency>

2) Create a logback.xml with below script, under resources, in project folder.

<configuration>
  <appender name="FILE" class="ch.qos.logback.core.FileAppender">
    <file>/var/log/datadog/app.log</file>
    <encoder class="net.logstash.logback.encoder.LogstashEncoder"/>
  </appender>
  	<appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
		<encoder>
			<pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
		</encoder>
	</appender>

  <root level="INFO">
  	<appender-ref ref="STDOUT" />
    <appender-ref ref="FILE"/>
    
  </root>
</configuration>

#######################Configure your EC2 instance for tailing the logs from a log file and sending it to datadog###################################

1) Login to EC2 insatnce where your java application has to be deployed.

2) Install datadog agent on Instance and verify if the agent is successfully running or not.

3) Open datadog configuation file(/etc/datadog-agent/datadog.yaml) using below command

sudo vi /etc/datadog-agent/datadog.yaml

4) Search for "Log collection Configuration" section and change the log_enabled parameter to true

(logs_enabled: true). Save the changes and exit.

5) Create a java configuration folder with the name java.d in "/etc/datadog-agent/conf.d" folder. Use the below command for creating this.

sudo mkdir -p /etc/datadog-agent/conf.d/java.d

6) Create and open conf.yaml file using "sudo vi conf.yaml" command and paste the below code, save and exit.

#Log section
logs:

  - type: file
    path: "/var/log/datadog/app.log"
    service: customer-service
    source: java
    sourcecategory: sourcecode
    # For multiline logs, if they start by the date with the format yyyy-mm-dd uncomment the following processing rule
    #log_processing_rules:
    #  - type: multi_line
    #    name: new_log_start_with_date
    #    pattern: \d{4}\-(0?[1-9]|1[012])\-(0?[1-9]|[12][0-9]|3[01])

7) Provide RWX permissions to "/var/log/datadog/" for appending and reading the logs which are generated by springboot application.

--> sudo chmod 777 /var/log/datadog/

8) Restart your datadog-agent and check the status using the below commands.

sudo service datadog-agent restart
sudo datadog-agent status









